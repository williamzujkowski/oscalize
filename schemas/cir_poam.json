{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://oscalize.local/schemas/cir_poam.json",
  "title": "CIR POA&M Schema",
  "description": "Canonical Intermediate Representation for Plan of Action and Milestones (FedRAMP v3.0)",
  "type": "object",
  "properties": {
    "metadata": {
      "type": "object",
      "properties": {
        "source_file": { "type": "string" },
        "sheet_name": { "type": "string" },
        "extraction_date": { "type": "string", "format": "date-time" },
        "template_version": { "type": "string" },
        "hash": { "type": "string" }
      },
      "required": ["source_file", "sheet_name", "extraction_date"]
    },
    "rows": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "poam_id": { "type": "string" },
          "title": { "type": "string" },
          "description": { "type": "string" },
          "severity": { 
            "type": "string", 
            "enum": ["Low", "Moderate", "High", "Critical"] 
          },
          "status": { 
            "type": "string", 
            "enum": ["Open", "Ongoing", "Completed", "Risk Accepted"] 
          },
          "scheduled_completion_date": { 
            "type": ["string", "null"], 
            "format": "date" 
          },
          "actual_completion_date": { 
            "type": ["string", "null"], 
            "format": "date" 
          },
          "control_ids": { 
            "type": "array", 
            "items": { "type": "string" } 
          },
          "asset_ids": { 
            "type": "array", 
            "items": { "type": "string" } 
          },
          "origin": { "type": "string" },
          "comments": { "type": "string" },
          "milestones": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "description": { "type": "string" },
                "scheduled_date": { "type": "string", "format": "date" },
                "status": { "type": "string" }
              },
              "required": ["description", "scheduled_date", "status"]
            }
          },
          "source": {
            "type": "object",
            "properties": {
              "file": { "type": "string" },
              "sheet": { "type": "string" },
              "row": { "type": "integer" },
              "col_range": { "type": "string" }
            },
            "required": ["file", "sheet", "row"]
          }
        },
        "required": ["poam_id", "title", "description", "severity", "status", "source"]
      }
    }
  },
  "required": ["metadata", "rows"]
}